{% load about_me %}
{% include 'base.html' %}
{% block content %}
{% load custom_filters %}
{% include "base_apps_NAV.html" %}
{% get_medication selected_strength as medication_update %}

<html data-bs-theme="light">

<head>
    <link rel="stylesheet" href="{% about_me 'css/pricing_tables.css' %}">

    <style>
      .main-content {
          margin-left: 7.5rem; /* Adjust this value to match the width of your first div */
      }

  </style>
</head>

<body>
  <div class="page cv-page main-content">
    <main class="page hire-me-page"></main>
    <div class="price-card">
        <form class="border rounded border-0 shadow-lg p-3 p-md-5" data-bs-theme="light" method="POST">
            {% csrf_token %}

            <div class="mb-3">
              <label class="form-label" for="name">NAME OF THE DRUG</label>
              <input type="text" id="name" name="name" value="{{ name_of_medication }}" required>
            </div>
            



            <div class="mb-3">
              <label class="form-label" for="strength">Strength</label>
              <select class="form-select" id="strength" name="strength" onchange="handleSelectionChange()">
                <optgroup label="Strength">
                  <option value="">None</option>
                  {% for strength in strengths %}
                    <option value="{{ strength }}">{{ strength }}</option>
                  {% endfor %}
                </optgroup>
              </select>
            </div>
            
            <div class="mb-3">
              <label class="form-label" for="dosage_form">DOSAGE FORM</label>
              <select class="form-select" id="dosage_form" name="dosage_form" onchange="handleSelectionChange()">
                <optgroup label="Dosage Form">
                  <option value="">None</option>
                  {% for dosage_form in dosage_forms %}
                    <option value="{{ dosage_form }}">{{ dosage_form }}</option>
                  {% endfor %}
                </optgroup>
              </select>
            </div>
            
            <p id="selectedStrength"> </p>
            <div id="medicationDetails"></div>
            
            <script>
              function handleSelectionChange() {
                var selectedStrength = encodeURIComponent(document.getElementById("strength").value);
                var selectedDosageForm = encodeURIComponent(document.getElementById("dosage_form").value);
                var drugName = encodeURIComponent(document.getElementById("name").value);
            
                // Make an AJAX call to fetch the medication details based on the selected strength, dosage form, and drug name
                var xhr = new XMLHttpRequest();
                xhr.open('GET', '/get_medication/?strength=' + selectedStrength + '&dosage_form=' + selectedDosageForm + '&name=' + drugName, true);
                xhr.onload = function() {
                  if (xhr.status === 200) {
                    var medicationDetails = JSON.parse(xhr.responseText);
                    if (Array.isArray(medicationDetails) && medicationDetails.length > 0) {
                      // Display details for each medication
                      var detailsHtml = "";
                      for (var i = 0; i < medicationDetails.length; i++) {
                        var medication = medicationDetails[i];
                        detailsHtml += "<div class='medication-details'>";
                        detailsHtml += "<p><strong>Name:</strong> " + medication.name + "</p>";
                        detailsHtml += "<p><strong>Generic Name:</strong> " + medication.generic_name + "</p>";
                        detailsHtml += "<p><strong>Manufacturer:</strong> " + medication.manufacturer + "</p>";
                        detailsHtml += "<p><strong>Price:</strong> " + medication.price + "</p>";
                        // Add more fields here
                        detailsHtml += "</div>";
                        detailsHtml += "<hr>";
                      }
                      document.getElementById("medicationDetails").innerHTML = detailsHtml;
                    } else {
                      // Display "No data found" message
                      document.getElementById("medicationDetails").innerHTML = "<p>No data found</p>";
                    }
                  } else {
                    console.error('Request failed. Status:', xhr.status);
                    // Display "No data found" message for error cases
                    document.getElementById("medicationDetails").innerHTML = "<p>No data found</p>";
                  }
                };
                xhr.onerror = function() {
                  console.error('Request failed. Network error');
                  // Display "No data found" message for network errors
                  document.getElementById("medicationDetails").innerHTML = "<p>No data found</p>";
                };
                xhr.send();
              }
            </script>  



          
            <div class="mb-3">

            </div>
            
            <div class="mb-3">
                <div class="row">
                    <div class="col-md-12 button">
                        <button class="btn btn-primary d-block w-100" type="submit" style="font-size: 18px;">
                            <strong><span style="color: rgb(252, 249, 249);">GET RECOMMENDATION</span></strong>
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
  </div>
</body>

</html>

{% endblock %}
