{% load about_me %}
{% include 'base.html' %}
{% block content %}
{% load custom_filters %}
{% include "MED_nav.html" %}
<html data-bs-theme="light">

<head>
    <link rel="stylesheet" href="{% about_me 'css/pricing_tables.css' %}">

  <style>
      .main-content {
          margin-left: 7.5rem; /* Adjust this value to match the width of your first div */
      }
  </style>
  <style>
    /* Define CSS styles for better visibility */
    .medication-details {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 10px;
    }
  
    .medication-group {
      color: blue; /* Change the color as per your preference */
      font-weight: bold;
    }
  
    .medication-indication {
      color: green; /* Change the color as per your preference */
    }
  
    .medication-score {
      color: red; /* Change the color as per your preference */
    }


  </style>
</head>

<body>
  <div class="page cv-page main-content">
    <main class="page hire-me-page"></main>
    <div class="price-card">
      <h2>PROVIDE THE BRAND NAME OF ANY BANGLADESHI DRUG TO DET DETAILS </h2>
      <form class="border rounded border-0 shadow-lg p-3 p-md-5" data-bs-theme="light" method="POST" onsubmit="handleFormSubmit(event)">
        {% csrf_token %}

        <div class="mb-3">
          <label class="form-label" for="name">NAME OF THE DRUG</label>
          <div id="name-container">
              <div class="mb-3 input-group">
                  <input class="form-control" type="text" id="name-0" name="name" value="" required oninput="showWordRecommendations(event, 0)">
                  <button type="button" class="btn btn-primary" onclick="addNameField()">Add Another Name Field</button>
              </div>
          </div>

      </div>

      <div id="wordRecommendations"></div>

        <p id="selectedStrength"></p>
        <div id="get_presciption_classification"></div>
        <!-- Add a dropdown menu for sorting -->
        <script src="{% about_me 'js/presciption_classification.js' %}"></script>
        
<script>

function handleSelectionChange() {
  var nameInputs = document.querySelectorAll("#name-container input");
    var drugNames = [];
    for (var i = 0; i < nameInputs.length; i++) {
      drugNames.push(encodeURIComponent(nameInputs[i].value));
    }

// Make an AJAX call to fetch the medication details based on the selected strength, dosage form, and drug name
var xhr = new XMLHttpRequest();
xhr.open('GET', '/get_presciption_classification_beta/?name=' + drugNames , true);
xhr.onload = function() {
  if (xhr.status === 200) {
    var get_presciption_classification = JSON.parse(xhr.responseText);

    // Assuming 'data' contains the JSON response from the server
    const drugClassGroups = get_presciption_classification.drug_class_groups;
    const allMachGroups = get_presciption_classification.all_mach_groups;
    const allMachGroups2 = get_presciption_classification.all_mach_groups_2;
    const all_groups_uniques = get_presciption_classification.all_matching_uniques;

    // Now you can use these variables as needed
    console.log(drugClassGroups);
    console.log(allMachGroups);
    console.log(allMachGroups2);
    console.log(all_groups_uniques);

    if (Array.isArray(drugClassGroups) && drugClassGroups.length > 0) {
      // Display details for each medication
      var detailsHtml = "";
      if (all_groups_uniques) {
        detailsHtml += "<h4> ALL MATCHING GROUPS </h4>";
        detailsHtml += "<div class='medication-details'>";
        detailsHtml += "<p><strong>classified releted drugs: </strong>" + all_groups_uniques[0] + "</p>";
        detailsHtml += "<p><strong>ALL MATCHING HEADINGS: </strong>" + all_groups_uniques[1] + "</p>";
        detailsHtml += "<p><strong>ALL MATCHING SPECIFIC CLASS: </strong>" + all_groups_uniques[2] + "</p>";
        detailsHtml += "<h4> DRUG CLASS </h4>";

    }
    detailsHtml += "</div>";

    if (allMachGroups) {
      for (var i = 0; i < allMachGroups.length; i++) {
        var medication = allMachGroups[i];
        detailsHtml += "<div class='medication-details'>";
        detailsHtml += "<p><strong>MATCHING COUPLE: </strong>" + medication.name1 + "&" + medication.name2 + "</p>";
        detailsHtml += "<h4> MACHING  ISSUES </h4>";

        if (medication.heading_matches && medication.specific_class_matches.length > 0) {
          detailsHtml += "<p><strong>SPECIFIC ISSUES: </strong>" + medication.specific_class_matches + "</p>";
        }
        else{
          detailsHtml += "<p><strong>PREDICTED ISSUES: </strong>" + medication.heading_matches + "</p>";
        }
        detailsHtml += "</div>";
      }
}


    detailsHtml += "</div>";

    // Display the details on the page
    document.getElementById("get_presciption_classification").innerHTML = detailsHtml;
  } else {
    console.error(xhr.responseText);
  }

  } else {
    console.error(xhr.statusText);
  }

};
xhr.onerror = function() {
  console.error('Request failed. Network error');
  // Display "No data found" message for network errors
  document.getElementById("get_presciption_classification").innerHTML = "<p>No data found</p>";
};
xhr.send();
}




</script>

          
            <div class="mb-3">

            </div>
            
            <div class="mb-3">
                <div class="row">
                    <div class="col-md-12 button">
                      <div class="d-flex align-items-center justify-content-center">

                        <button class="btn btn-primary d-block w-50" type="submit" style="font-size: 12px;">
                          <strong><span style="color: rgb(252, 249, 249);">GET MEDICINE DETAILS</span></strong>
                        </button>
                         </form>

                         <!-- Using anchor tag to create a link that turns red on hover -->
                        <a href="{% url 'medicine_chatbot' %}" class="btn btn-warning d-block w-50 custom-button" style="font-size: 12px;">
                          <strong><span style="color: rgb(245, 244, 244);">TALK WITH YOUR MEDICINES</span></strong>
                          
                        </a>


                      </div>  
                    </div>

         
                </div>
            </div>

    </div>
  </div>
</body>

</html>

{% endblock %}
